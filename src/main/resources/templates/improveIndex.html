<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Feed reader</title>
    <meta content="" name="descriptison">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon">
    <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="/css/google-fonts.css" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/vendor/icofont/icofont.min.css" rel="stylesheet">
    <link href="/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="/vendor/owl.carousel//owl.carousel.min.css" rel="stylesheet">
    <link href="/vendor/venobox/venobox.css" rel="stylesheet">
    <link href="/vendor/aos/aos.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="/css/style.css" rel="stylesheet">

    <!-- =======================================================
    * Template Name: Vesperr - v2.0.0
    * Template URL: https://bootstrapmade.com/vesperr-free-bootstrap-template/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>

<body>

    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top d-flex align-items-center">
        <div class="container d-flex align-items-center">

            <div class="logo mr-auto">
                <h1 class="text-light"><a href="/"><span>Feed reader</span></a></h1>
                <!-- Uncomment below if you prefer to use an image logo -->
                <!-- <a href="index.html"><img src="/img/logo.png" alt="" class="img-fluid"></a>-->
            </div>

            <nav class="nav-menu d-none d-lg-block">
                <ul>
                    <li class="active"><a href="#header">Home</a></li>
                    <li><a href="#load-feed">Load your feed</a></li>
                    <li><a href="#services">Services</a></li>
                    <li><a href="#portfolio">Portfolio</a></li>
                    <li><a href="#team">Team</a></li>
                    <li><a href="#pricing">Pricing</a></li>
                    <!-- <li class="drop-down"><a href="">Drop Down</a>
                        <ul>
                            <li><a href="#">Drop Down 1</a></li>
                            <li class="drop-down"><a href="#">Drop Down 2</a>
                                <ul>
                                    <li><a href="#">Deep Drop Down 1</a></li>
                                    <li><a href="#">Deep Drop Down 2</a></li>
                                    <li><a href="#">Deep Drop Down 3</a></li>
                                    <li><a href="#">Deep Drop Down 4</a></li>
                                    <li><a href="#">Deep Drop Down 5</a></li>
                                </ul>
                            </li>
                            <li><a href="#">Drop Down 3</a></li>
                            <li><a href="#">Drop Down 4</a></li>
                            <li><a href="#">Drop Down 5</a></li>
                        </ul>
                    </li> -->
                    <li><a href="#contact">Contact</a></li>

                    <li class="get-started"><a href="#load-feed">Load your feed</a></li>
                </ul>
            </nav><!-- .nav-menu -->

        </div>
    </header><!-- End Header -->

    <!-- ======= Hero Section ======= -->
    <section id="hero" class="d-flex align-items-center">

        <div class="container">
            <div class="row">
                <div class="col-lg-6 pt-5 pt-lg-0 order-2 order-lg-1 d-flex flex-column justify-content-center">
                    <h1 data-aos="fade-up">Improve your news feed</h1>
                    <h2 data-aos="fade-up" data-aos-delay="400">Choose your source. Get updates in short time.</h2>
                    <div data-aos="fade-up" data-aos-delay="800">
                        <a href="#load-feed" class="btn-get-started scrollto">Load your feed</a>
                    </div>
                </div>
                <div class="col-lg-6 order-1 order-lg-2 hero-img" data-aos="fade-left" data-aos-delay="200">
                    <img src="/img/hero-img.png" class="img-fluid animated" alt="">
                </div>
            </div>
        </div>

    </section><!-- End Hero -->

    <main id="main">


        <!-- ======= load feed Section ======= -->
        <section id="load-feed" class="contact">
            <div class="container">

                <div class="section-title" data-aos="fade-up">
                    <h2>Load your feed</h2>
                </div>

                <div class="row">

                    <div class="col-lg-6 col-md-6" data-aos="fade-up" data-aos-delay="100">
                        <div class="contact-about">
                            <h3>Feed reader</h3>
                            <p>Here you can send a link to the source of the news feed and the rule for its analysis</p>
                            <h3>How it works</h3>
                            <p>Your request will be added to the list of sources. Every 3 minutes, the application
                                attempts to extract data from the URL and analyze it in accordance with the rules. In
                                case of success all news records will be added to database</p>
                        </div>
                    </div>

                    <div class="col-lg-6 col-md-12" data-aos="fade-up" data-aos-delay="300">
                        <form>
                            <div class="form-group">
                                <input type="text" name="feedSource" class="form-control" id="feedSource"
                                    placeholder="Link to news feed" data-rule="minlen:6"
                                    data-msg="Please enter at least 6 chars" />
                                <div class="validate"></div>
                            </div>
                            <div class="form-group">
                                <textarea class="form-control" id="feedRule" name="feedRule" rows="5"
                                    data-rule="required" data-msg="Paste here rule for parsing"
                                    placeholder="Rule for parsing"></textarea>
                                <div class="validate"></div>
                            </div>

                            <div class="text-center"><button id="sendData">Add to task list</button></div>
                        </form>
                    </div>

                </div>

            </div>
        </section><!-- End Contact Section -->

        <!---->
        <!-- ======= Records Section ======= -->
        <section id="recordsSection" class="features">
            <div class="container">

                <div class="section-title" data-aos="fade-up">
                    <h2>Records</h2>
                    <p>Press button for load or update feed</p>
                    <br />
                    <button id="loadAllRecords">Load feed</button>
                </div>
            </div>
            <div class="container" id="records">
            </div>
        </section>
        <!-- End Features Section -->
        <!-- ======= Contact Section ======= -->
        <section id="contact" class="contact">
            <div class="container">

                <div class="section-title" data-aos="fade-up">
                    <h2>CONTACT US</h2>
                </div>

                <div class="row">

                    <div class="col-lg-6 col-md-6" data-aos="fade-up" data-aos-delay="100">
                        <div class="contact-about">
                            <div class="social-links">
                                <a href="https://www.instagram.com/oleg.galimov/" class="instagram"><i
                                        class="icofont-instagram"></i></a>
                                <a href="https://github.com/oleggalimov/rssparcer" class="github"><i
                                        class="icofont-github"></i></a>
                                Developed by Oleg Galimov
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mt-4 mt-md-0" data-aos="fade-up" data-aos-delay="200">
                        <div class="info">
                            <div>
                                <i class="ri-map-pin-line"></i>
                                <p>Yekaterinburg, Russia</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mt-4 mt-md-0" data-aos="fade-up" data-aos-delay="200">
                        <div class="info">
                            <div>
                                <i class="ri-mail-send-line"></i>
                                <p>o.d.galimov@yandex.ru</p>
                            </div>

                        </div>
                    </div>

                </div>

            </div>
        </section><!-- End Contact Section -->

    </main><!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer">
        <div class="container">
            <div class="row d-flex align-items-center">
                <div class="col-lg-6 text-lg-left text-center">
                    <div class="copyright">
                        &copy; Copyright <strong>Oleg Galimov</strong>. All Rights Reserved
                    </div>
                    <div class="credits">
                        <!-- All the links in the footer should remain intact. -->
                        <!-- You can delete the links only if you purchased the pro version. -->
                        <!-- Licensing information: https://bootstrapmade.com/license/ -->
                        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/vesperr-free-bootstrap-template/ -->
                        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <nav class="footer-links text-lg-right text-center pt-2 pt-lg-0">
                        <a href="#header" class="scrollto">Home</a>
                    </nav>
                </div>
            </div>
        </div>
    </footer><!-- End Footer -->

    <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

    <!-- Vendor JS Files -->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="/vendor/php-email-form/validate.js"></script>
    <script src="/vendor/waypoints/jquery.waypoints.min.js"></script>
    <script src="/vendor/counterup/counterup.min.js"></script>
    <script src="/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="/vendor/venobox/venobox.min.js"></script>
    <script src="/vendor/aos/aos.js"></script>

    <!-- Template Main JS File -->
    <script src="/js/main.js"></script>
    <script>
        document.getElementById("sendData").addEventListener("click", loadData);
        document.getElementById("loadAllRecords").addEventListener("click", loadAllRecords);
        function loadData(event) {
            event.preventDefault();
            var url = document.getElementById("feedSource").value;
            var extractingRuleString = document.getElementById("feedRule").value;
            var extractingRuleObject = JSON.parse(extractingRuleString);
            var request = new Object();
            request.url = url;
            request.extractingRule = extractingRuleObject;

            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "api/feed/load", true);
            xhttp.setRequestHeader('Content-Type', 'application/json');
            xhttp.send(JSON.stringify(request));
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4) {
                    if (this.status == 200) {
                        alert("The loading result is: " + xhttp.responseText);
                        document.getElementById("feedRule").value = "";
                        document.getElementById("feedSource").value = "";
                    } else {
                        alert("The loading result is: " + xhttp.responseText);
                    }
                }
            }

            return false;
        }
        function loadAllRecords(event) {
            event.preventDefault();

            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", "api/feed/list/", true);
            xhttp.send();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4) {
                    if (this.status == 200) {
                        parseResult(xhttp.response);
                    } else {
                        alert("The loading result is: " + xhttp.responseText);
                    }
                }
            }
        }
        function parseResult(data) {
            var records = JSON.parse(data);
            if (records == undefined || records.length == 0) {
                return null;
            }
            //records
            var recordsContainer = document.getElementById("records");
            recordsContainer.childNodes=null;
            for (var i = 0; i < records.length; i++) {
                var recordElement = records[i];
                //<div class="row" data-aos="fade-up" data-aos-delay="300">
                var row = document.createElement("div");
                row.setAttribute("class", "row");
                row.setAttribute("data-aos", "fade-up");
                row.setAttribute("data-aos-delay", "300");
                //<div class="col-lg-12 col-md-4 mt-6">
                var col = document.createElement("div");
                col.setAttribute("class", "col-lg-12 col-md-4 mt-6");
                //<div class="icon-box">
                var iconBox = document.createElement("i");
                iconBox.setAttribute("class", "icon-box");
                //<i class="ri-file-list-3-line" style="color: #11dbcf;"></i>
                var iElement = document.createElement("i");
                iElement.setAttribute("class", "ri-file-list-3-line");
                iElement.setAttribute("style", "color: #11dbcf;");
                
                var paragraph = document.createElement("p");
                paragraph.appendChild(document.createTextNode("Title: "+recordElement.title));
                paragraph.appendChild(document.createElement('br'));
                paragraph.appendChild(document.createTextNode("Description: "+recordElement.description));
                paragraph.appendChild(document.createElement('br'));
                paragraph.appendChild(document.createTextNode("Source: "+recordElement.link));
                paragraph.appendChild(document.createElement('br'));
                paragraph.appendChild(document.createTextNode("Channel: "+recordElement.channel.channelTitle));
                paragraph.appendChild(document.createElement('br'));
                paragraph.appendChild(document.createTextNode("Date: "+recordElement.pubDate));
                paragraph.appendChild(document.createElement('br'));
                paragraph.appendChild(document.createTextNode("Load date: "+new Date(recordElement.loadEpochTimeStamp)));
                
                iconBox.appendChild(iElement);
                iconBox.appendChild(paragraph);

                col.appendChild(iconBox);

                row.appendChild(col);
                recordsContainer.appendChild(row);
            }

        }

    </script>
</body>

</html>